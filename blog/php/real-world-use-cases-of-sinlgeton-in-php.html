<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>PHP Real-world use cases of singleton design pattern | imdhemy</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="PHP Real-world use cases of singleton design pattern" />
<meta name="author" content="Mohamad Eldhemy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The singleton pattern ensures that a class has only one instance and provides global access to it. Okay, many developers consider the singleton is an anti-pattern and many others don’t. The most common reason for using a singleton is to control access to some shared resources, database connection which is an expensive resource or a file." />
<meta property="og:description" content="The singleton pattern ensures that a class has only one instance and provides global access to it. Okay, many developers consider the singleton is an anti-pattern and many others don’t. The most common reason for using a singleton is to control access to some shared resources, database connection which is an expensive resource or a file." />
<link rel="canonical" href="https://imdhemy.com/blog/php/real-world-use-cases-of-sinlgeton-in-php.html" />
<meta property="og:url" content="https://imdhemy.com/blog/php/real-world-use-cases-of-sinlgeton-in-php.html" />
<meta property="og:site_name" content="imdhemy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-30T12:45:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PHP Real-world use cases of singleton design pattern" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Mohamad Eldhemy"},"description":"The singleton pattern ensures that a class has only one instance and provides global access to it. Okay, many developers consider the singleton is an anti-pattern and many others don’t. The most common reason for using a singleton is to control access to some shared resources, database connection which is an expensive resource or a file.","url":"https://imdhemy.com/blog/php/real-world-use-cases-of-sinlgeton-in-php.html","@type":"BlogPosting","headline":"PHP Real-world use cases of singleton design pattern","dateModified":"2021-12-30T12:45:00+00:00","datePublished":"2021-12-30T12:45:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://imdhemy.com/blog/php/real-world-use-cases-of-sinlgeton-in-php.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css?t=2022-01-14-13-35"><link type="application/atom+xml" rel="alternate" href="https://imdhemy.com/feed.xml" title="imdhemy" /></head>
<body><div class="container mx-auto pt-7 pb-7">
    <header class="flex flex-row">
        <!-- Brand start-->
        <div class="p-5">
            <a href="/" class="flex justify-start items-center mr-3 hover:no-underline block">
                <img class="w-5 h-5 lg:w-10 lg:h-10" src="/logo.png" alt="imdhemy">
                <span class="font-bold text-xl lg:text-4xl text-black font-sans">imdhemy</span>
            </a>
        </div>
        <!-- Brand End -->

        <!-- Mobile Navigation Start -->
        <div class="flex-auto flex justify-end p-5 lg:hidden">
            <button id="nav-controller" class="focus:outline-none block">
                <ion-icon class="text-4xl w-10 h-10 p-0 m-0" name="menu-outline"></ion-icon>
            </button>
            <div id="mobile-nav-menu" class="fixed bg-white right-0 bottom-0 left-0 hidden">
                <div class="flex h-full justify-center p-10">
                    <ul class="flex flex-col justify-center text-left p-0 m-0">
                        
                        
                        <li class="text-3xl font-light mobile-nav-link-item"><a href="/">Home</a></li>
                        
                        
                        
                        <li class="text-3xl font-light mobile-nav-link-item"><a href="/blog">Blog</a></li>
                        
                        
                        
                        <li class="text-3xl font-light mobile-nav-link-item"><a href="/about">About</a></li>
                        
                        
                    </ul>
                </div>
            </div>
        </div>
        <!-- Mobile Navigation End -->

        <!-- Desktop Navigation Start -->
        <div class="hidden lg:block flex-auto flex p-5">
            
            
            <ul class="flex justify-end text-left p-0 m-0">
                
                
                
                
                <li class="text-xl font-light mobile-nav-link-item nav-item"><a href="/">Home</a></li>
                
                
                
                
                
                
                <li class="text-xl font-light mobile-nav-link-item nav-item nav-item-active"><a href="/blog">Blog</a></li>
                
                
                
                
                
                
                <li class="text-xl font-light mobile-nav-link-item nav-item"><a href="/about">About</a></li>
                
                
                
            </ul>
        </div>
        <!-- Desktop Navigation End -->
    </header>
</div>
<main class="container mx-auto lg:w-2/3" aria-label="Content">
    <header class="container mx-auto p-5 text-center">
    <h1 class="post-title p-name" itemprop="name headline">PHP Real-world use cases of singleton design pattern</h1>
    <p class="post-meta">
        <time class="dt-published" datetime="2021-12-30T12:45:00+00:00" itemprop="datePublished">Dec 30, 2021
        </time>
        
        • <span>php</span>
        
    </p>
</header>

<article class="bg-white rounded-lg drop-shadow-md lg:ml-0 lg:mr-0 ml-5 mr-5 mb-20" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="p-5 post-content" itemprop="articleBody">
        <p>The singleton pattern ensures that a class has only one instance and provides global access to it. Okay, many developers consider the singleton is an anti-pattern and many others don’t. The most common reason for using a singleton is to control access to some shared resources, database connection which is an expensive resource or a file.</p>

<p><strong>The singleton pattern is responsible for:</strong></p>
<ul>
  <li>Creating an instance of its class.</li>
  <li>Ensures that a class has just a single instance.</li>
</ul>

<p>This obviously violates the Single Responsibility Principle, as the pattern solves two problems at the same time.</p>

<p>In the following lines, I’ll start by explaining <strong>how to implement a singleton</strong>, then I’ll discuss how <strong>Laravel Container</strong> uses the singleton pattern, Finally, show you how the Local Adapter within <strong>Flysystem</strong> PHP package uses the same concept to manipulate files.</p>

<h2 id="how-to-implement-a-singleton">How to implement a singleton</h2>
<p>The Singleton class declares the static method <code class="language-plaintext highlighter-rouge">getInstance</code> that returns the same instance of its class. To do so, we declare a static private property that holds the instance. By checking its value we can decide whether to create a new instance or return the already instantiated one. The Singleton <code class="language-plaintext highlighter-rouge">constructor</code> should be hidden from the client code. Calling the <code class="language-plaintext highlighter-rouge">getInstance</code> method should be the only way to create an instance of the Singleton class. Cloning the object should be prevented as well.</p>

<p><strong>I start by writing tests…</strong></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//SingletonTest.php
<span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Tests</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Com\Imdhemy\Singleton</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Error</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">SingletonTest</span> <span class="kd">extends</span> <span class="nc">TestCase</span>
<span class="p">{</span>
    <span class="cd">/**
     * @test
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">it_can_be_instantiated_by_a_static_factory_method</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$instance</span> <span class="o">=</span> <span class="nc">Singleton</span><span class="o">::</span><span class="nf">getInstance</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">assertInstanceOf</span><span class="p">(</span><span class="nc">Singleton</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="nv">$instance</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cd">/**
     * @test
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">it_must_return_the_same_instance_every_time</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$firstCall</span> <span class="o">=</span> <span class="nc">Singleton</span><span class="o">::</span><span class="nf">getInstance</span><span class="p">();</span>
        <span class="nv">$secondCall</span> <span class="o">=</span> <span class="nc">Singleton</span><span class="o">::</span><span class="nf">getInstance</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">assertSame</span><span class="p">(</span><span class="nv">$firstCall</span><span class="p">,</span> <span class="nv">$secondCall</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cd">/**
     * @test
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">it_should_not_be_instantiated_through_a_constructor</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">expectException</span><span class="p">(</span><span class="nc">Error</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
        <span class="k">new</span> <span class="nc">Singleton</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cd">/**
     * @test
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">it_should_not_be_cloned</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">expectException</span><span class="p">(</span><span class="nc">Error</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
        <span class="nv">$instance</span> <span class="o">=</span> <span class="nc">Singleton</span><span class="o">::</span><span class="nf">getInstance</span><span class="p">();</span>
        <span class="k">clone</span> <span class="nv">$instance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>And here is the Singleton class code…</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//Singleton.php
<span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Com\Imdhemy</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Singleton</span>
<span class="p">{</span>
    <span class="cd">/**
     * @var Singleton|null
     */</span>
    <span class="k">private</span> <span class="k">static</span> <span class="o">?</span><span class="nc">Singleton</span> <span class="nv">$instance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="cd">/**
     * Singleton constructor
     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Prevents Cloning
     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">__clone</span><span class="p">():</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cd">/**
     * @return Singleton
     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">getInstance</span><span class="p">():</span> <span class="kt">Singleton</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$instance</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">static</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">static</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="why-laravel-container-is-a-special-singleton-class">Why Laravel Container is a special singleton class</h2>
<p>If you checked the <a href="https://github.com/laravel/framework/blob/8.x/src/Illuminate/Foundation/Application.php#L29">Laravel source code</a>, you will find that the <code class="language-plaintext highlighter-rouge">Application</code> class extends the <code class="language-plaintext highlighter-rouge">Container</code> class. The latter is a special singleton implementation. It makes sense to have a single instance of the application within your application.</p>

<p>You can easily find the <code class="language-plaintext highlighter-rouge">getInstance</code> <a href="https://github.com/laravel/framework/blob/8.x/src/Illuminate/Container/Container.php#L1382-L1389">method on the Container class</a>, but if you checked the container constructor, you <strong>will not</strong> find a private constructor. This is why I’m saying that the Laravel Container is a special singleton. It’s implemented in a way that gains the pros of a Singleton and avoids the cons.</p>

<p>Laravel developers are smart enough to realize that <em>it’s completely fine to have a single object within your application, but it’s not fine to make it impossible to make a second instance</em>.</p>

<h2 id="a-single-instance-of-a-file-counts-as-a-singleton">A single instance of a file counts as a singleton</h2>

<p>The term Singleton comes from mathematics. In mathematics, a Singleton, also known as a unit set, is a set with exactly one element. For example, the set <code class="language-plaintext highlighter-rouge">{M}</code> is a singleton containing the element <code class="language-plaintext highlighter-rouge">M</code>.</p>

<p>Let’s imagine the situation when a particular part of your application code is manipulating the contents of a local file, and another part is updating the same file simultaneously! For instance, the first one is adding to the file, and the other one is removing lines from there! Definitely, this will result in inconsistent file contents.</p>

<p>As a solution, we need to ensure having a single instance of the file resource on our application during manipulation. Actually this is not a singleton class implementation, but it still implies the mathematics definition of a singleton.</p>

<p>The wonderful <a href="https://github.com/thephpleague/flysystem">Flysystem</a> PHP package provides one interface to interact with many types of filesystems.</p>

<p>Flysystem ships with a default adapter, which is the Local adapter. By default, this adapter <a href="https://github.com/thephpleague/flysystem/blob/2.x/src/Local/LocalFilesystemAdapter.php#L87">uses a lock</a> during writes and updates.</p>

<h2 id="summary">Summary</h2>

<p>Singleton is a creational design pattern, which ensures that only one object of its kind exists and provides a single point of access to it for any other code.</p>

<p>I’d prefer to assign the responsibility of ensuring having only one object to another Class or helper or at least do the same as Laravel developers did, and I’d also avoid hiding the constructor.</p>

<p>It’s completely fine to have a single object within your application, but it’s not fine to make it impossible to make a second instance.</p>

    </div><a class="u-url" href="/blog/php/real-world-use-cases-of-sinlgeton-in-php.html" hidden></a>
</article>

</main><footer class="bg-white">
    <div class="container mx-auto lg:p-0 p-5">
        <div class="flex flex-col justify-center pt-10 pb-10 text-lg">
            <div class="flex-1 text-center">
                <p>Let's get together</p>
                <ul class="footer-social-links p-0 m-0">
                    
                    <li class="inline"><a href="https://twitter.com/imdhemy">Twitter</a></li>
                    
                    <li class="inline"><a href="https://github.com/imdhemy">Github</a></li>
                    
                    <li class="inline"><a href="https://linkedin.com/in/imdhemy">Linkedin</a></li>
                    
                </ul>
            </div>

            <div class="flex-1 text-center mt-10">
                <p>&copy; 2021 - 2022 imdhemy.com</p>
            </div>
        </div>
    </div>
</footer>

<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<script src="https://imdhemy.com/assets/js/script.js?v=2022-01-14-13-35"></script>
</body>

</html>
