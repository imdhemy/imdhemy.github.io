<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How to organize your unit tests | imdhemy</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="How to organize your unit tests" />
<meta name="author" content="Mohamad Eldhemy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="One day, in the school of medicine, the lecturer told us an important thing about naming. He was explaining the self-clearing mechanism of the airways in the respiratory system which is known as mucociliary escalator and he said, to understand anything in medicine, you need to understand the idea behind the name, you need to understand the culture behind the name. Check the following image, it auto-moves the particles outside the lungs like an escalator." />
<meta property="og:description" content="One day, in the school of medicine, the lecturer told us an important thing about naming. He was explaining the self-clearing mechanism of the airways in the respiratory system which is known as mucociliary escalator and he said, to understand anything in medicine, you need to understand the idea behind the name, you need to understand the culture behind the name. Check the following image, it auto-moves the particles outside the lungs like an escalator." />
<link rel="canonical" href="https://imdhemy.com/blog/testing/how-to-organize-your-unit-tests.html" />
<meta property="og:url" content="https://imdhemy.com/blog/testing/how-to-organize-your-unit-tests.html" />
<meta property="og:site_name" content="imdhemy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-11-11T22:48:41+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to organize your unit tests" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mohamad Eldhemy"},"dateModified":"2022-11-11T22:48:41+00:00","datePublished":"2022-11-11T22:48:41+00:00","description":"One day, in the school of medicine, the lecturer told us an important thing about naming. He was explaining the self-clearing mechanism of the airways in the respiratory system which is known as mucociliary escalator and he said, to understand anything in medicine, you need to understand the idea behind the name, you need to understand the culture behind the name. Check the following image, it auto-moves the particles outside the lungs like an escalator.","headline":"How to organize your unit tests","mainEntityOfPage":{"@type":"WebPage","@id":"https://imdhemy.com/blog/testing/how-to-organize-your-unit-tests.html"},"url":"https://imdhemy.com/blog/testing/how-to-organize-your-unit-tests.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css?t=2022-11-13-14-54"><link type="application/atom+xml" rel="alternate" href="https://imdhemy.com/feed.xml" title="imdhemy" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WG1WZ488DX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WG1WZ488DX');
</script>
</head>
<body><div class="container mx-auto pt-7 pb-7">
    <header class="flex flex-row">
        <!-- Brand start-->
        <div class="p-5">
            <a href="/" class="flex justify-start items-center mr-3 hover:no-underline block">
                <img class="w-5 h-5 lg:w-10 lg:h-10" src="/logo.png" alt="imdhemy">
                <span class="font-bold text-xl lg:text-4xl text-black font-sans">imdhemy</span>
            </a>
        </div>
        <!-- Brand End -->

        <!-- Mobile Navigation Start -->
        <div class="flex-auto flex justify-end p-5 lg:hidden">
            <button id="nav-controller" class="focus:outline-none block">
                <ion-icon class="text-4xl w-10 h-10 p-0 m-0" name="menu-outline"></ion-icon>
            </button>
            <div id="mobile-nav-menu" class="fixed bg-white right-0 bottom-0 left-0 hidden">
                <div class="flex h-full justify-center p-10">
                    <ul class="flex flex-col justify-center text-left p-0 m-0">
                        
                        
                        <li class="text-3xl font-light mobile-nav-link-item"><a href="/">Home</a></li>
                        
                        
                        
                        <li class="text-3xl font-light mobile-nav-link-item"><a href="/blog">Blog</a></li>
                        
                        
                        
                        <li class="text-3xl font-light mobile-nav-link-item"><a href="/about">About</a></li>
                        
                        
                    </ul>
                </div>
            </div>
        </div>
        <!-- Mobile Navigation End -->

        <!-- Desktop Navigation Start -->
        <div class="hidden lg:block flex-auto flex p-5">
            
            
            <ul class="flex justify-end text-left p-0 m-0">
                
                
                
                
                <li class="text-xl font-light mobile-nav-link-item nav-item"><a href="/">Home</a></li>
                
                
                
                
                
                
                <li class="text-xl font-light mobile-nav-link-item nav-item nav-item-active"><a href="/blog">Blog</a></li>
                
                
                
                
                
                
                <li class="text-xl font-light mobile-nav-link-item nav-item"><a href="/about">About</a></li>
                
                
                
            </ul>
        </div>
        <!-- Desktop Navigation End -->
    </header>
</div>
<main class="container mx-auto lg:w-2/3" aria-label="Content">
    <header class="container mx-auto p-5 text-center">
    <h1 class="post-title p-name" itemprop="name headline">How to organize your unit tests</h1>
    <p class="post-meta">
        <time class="dt-published" datetime="2022-11-11T22:48:41+00:00" itemprop="datePublished">Nov 11, 2022
        </time>
        
        • <span>testing</span>
        
    </p>
</header>

<article class="bg-white rounded-lg filter drop-shadow-md lg:ml-0 lg:mr-0 ml-5 mr-5 mb-20" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="p-5 post-content" itemprop="articleBody">
        <p>One day, in the school of medicine, the lecturer told us an important thing about naming. He was explaining the self-clearing mechanism of the airways in the respiratory system which is known as <strong>mucociliary escalator</strong> and he said, to understand anything in medicine, you need to understand the idea behind the name, you need to understand the culture behind the name. Check the following image, it auto-moves the particles outside the lungs like an escalator.</p>

<p>We are not native English speakers, so this advice applies to us.</p>

<p><img src="/assets/img/mucociliary-escalator.gif" alt="mucociliary escalator" /> 
<img src="/assets/img/escalator-fail.gif" alt="escalator fail" /></p>

<p>I believe it’s the same for programming, understanding the idea or the culture behind the name makes it easier to understand the concept. So, let’s talk about the idea behind the names of the unit tests.</p>

<h2 id="the-names-in-testing">The names in testing</h2>

<p>In general, testing is finding out how well something works. In terms of human beings, testing tells what level of knowledge or skill has been acquired. In terms of electronics, testing tells how well the device works.</p>

<p>The device under test is the thing that is being tested. In the case of testing car stability, the car is the device under test. It’s referred to as <strong>DUT</strong>.</p>

<p>Engineers may use a device called <strong>test fixture</strong> to test the DUT. The test fixture is a device that is used to hold the DUT in a specific position or to provide a particular input or output to the DUT. In the case of testing car stability, the test fixture may be a ramp.</p>

<p>Let’s map this to programming. The DUT will be <strong>SUT</strong> (System under test). The test fixture is a piece of data that could be a dependency or an argument passed to the SUT. It can also be data in the database or a file in the file system.</p>

<p class="note">
The test fixture's state and behavior should not change during the test, the ramp remains a ramp, or at least the changes should be predictable and controllable.
</p>

<h2 id="test-file-location">Test file location</h2>

<p>There are two conventions for organizing the test files. The first one is to put the test files in the same directory as the source files. The second one is to put the test files in a separate directory. The first is called <strong>in-place</strong> and the second is called <strong>out-of-place</strong>.</p>

<p><strong>In-place</strong> tests are painless to find, you see at a glance if a part of your application lacks tests. When you move the source (inevitable), you remember to move the test, When you rename the source (inevitable), you remember to rename the test. The downside is where to put integration tests, as they don’t belong to any specific source file. It’s often better to create an appropriate directory for them in the <code class="language-plaintext highlighter-rouge">tests</code> directory.</p>

<p><strong>Out-of-place</strong> tests have a natural home directory <code class="language-plaintext highlighter-rouge">tests</code>. The directories and files in the <code class="language-plaintext highlighter-rouge">tests</code> directory should mirror their corresponding source files. This way, you can easily integrate the tests with your IDE.</p>

<p>I prefer the <strong>out-of-place</strong> convention, even if I have to remember to move or rename the test files to reflect the changes in the source files, but I’m not dogmatic about it. I’m open to changing my mind if I find a good reason to do so.</p>

<h2 id="how-to-struct-a-test-case">How to struct a test case</h2>

<p>Structuring a test case starts with naming the test method. It’s often to encounter the following pattern: <code class="language-plaintext highlighter-rouge">[MethodUnderTest]_[Scenario]_[ExpectedResult]</code>. I used to follow this pattern, but I found it not very helpful. It focuses on the implementation details, not the behavior.</p>

<p>The pattern I prefer is PLAIN ENGLISH. We describe in plain English what we’re testing in a language easy to understand, even for non-programmers.</p>

<p>Using plain English is required by the nature of some test frameworks. For example, in the case of <a href="https://jestjs.io/">Jest</a>, the test method name is the test case name. So, you have to use plain English to name the test method. You can do the same with the xUnit frameworks.</p>

<p>I also prefer to separate words by underscores, it makes it easier to read. I use snake case for the test method names, even if the convention in the language or the framework is camel case. Yes, I know it’s not consistent and it breaks the coding style, but I’m open to breaking rules if I find a good reason to do so. It’s easy to exclude the test files from the coding style check of this rule.</p>

<p>The good reason here is readability, just compare the readability of the following two test method names:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ItShouldIlluminateTheLedAtLowLevelLight
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It_should_illuminate_the_led_at_low_level_light
</code></pre></div></div>

<p>The snake case version is much easier to read, as it resebles the natural way of using spaces between words.</p>

<p><strong>So, what about the body of the test case?</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">Given-When-Then</code> or <code class="language-plaintext highlighter-rouge">Arrange-Act-Assert</code> is a great way to structure test cases. It prescribes an order of operations:</p>

<h3 id="given-arrange">Given (Arrange)</h3>

<p>The <code class="language-plaintext highlighter-rouge">Given</code> section is where you set up the test case. You do all the preparations to make the test case ready to run. You may require a fixture, a dependency, a database, a file, etc. You need also to set the initial state. This section should end by creating the SUT instance in the initial state.</p>

<p>As far as I know, all xUnit frameworks provide a <code class="language-plaintext highlighter-rouge">setup</code> method to do the preparations. Even though this is not the place to put the <code class="language-plaintext highlighter-rouge">Given</code> section.</p>

<p class="note">
The `setup` method is not the place to put the `Given` section. The `setup` method is for the preparations that are common to all test cases. The `Given` section is for the preparations that are specific to the test case.
</p>

<p>Putting the <code class="language-plaintext highlighter-rouge">Given</code> section in the <code class="language-plaintext highlighter-rouge">setup</code> method is not a good idea, because it makes the test case less readable, and it couples the test cases together. If you need to change the initial state of the SUT, you have to change the <code class="language-plaintext highlighter-rouge">setup</code> method, which may break other tests. The <code class="language-plaintext highlighter-rouge">Given</code> section should be as close to the <code class="language-plaintext highlighter-rouge">When</code> section.</p>

<p>If your <code class="language-plaintext highlighter-rouge">Given</code> section has a boilerplate code, you can extract each part to a factory method with a descriptive name. This way, you can reuse the factory method in other test cases.</p>

<p>For instance, <code class="language-plaintext highlighter-rouge">createUser()</code>, <code class="language-plaintext highlighter-rouge">createUserWithOrders()</code>, and <code class="language-plaintext highlighter-rouge">createUserWithOrdersAndPayments()</code> are factory methods that create a user with a different initial state.</p>

<h3 id="when-act">When (Act)</h3>

<p>The <code class="language-plaintext highlighter-rouge">When</code> section is where you execute the action under test. It SHOULD be a single operation. If you need to execute multiple operations, it’s a sign that you are not unit testing! You can find more about this in the <a href="/blog/testing/what-is-a-unit-test">What is a unit test?</a> post.</p>

<h3 id="then-assert">Then (Assert)</h3>

<p>The <code class="language-plaintext highlighter-rouge">Then</code> section is where you assert the expected result. Assertions will ultimately determine the success or failure of the test case. Each xUnit framework provides a set of assertion methods. You can use them to assert the expected result or you can require a third-party assertion library. For example, <a href="https://www.chaijs.com/">Chai</a> is a popular assertion library for Node.js. PHPUnit has a built-in assertion library, but Laravel provides a wrapper for the <a href="https://laravel.com/docs/9.x/http-tests#available-assertions">PHPUnit assertions</a>.</p>

<h2 id="dont-abuse-database-fixtures-and-seeds">Don’t abuse database fixtures and seeds</h2>

<p>You may encounter a test suite that uses database fixtures to set the initial state of the database. This is a bad idea. Do you remember when we said A RAMP IS A RAMP? if some data is going to change, it’s not a fixture anymore. The downsides of using database fixtures are:</p>

<p>You have to run the DB fixtures before each test to prepare the initial state, which makes the test suite slow, and coupled. The thing which breaks the test isolation.</p>

<p>Changing a state of a DB fixture in one test will affect the other tests, and it forces you to run them in a specific order.</p>

<p>So, what’s a fixture then? A fixture is a piece of data that should not change during the test. It could be a JSON file containing a particular response, a file to test the upload functionality, or a database record containing a global configuration or a list of countries.</p>

<p><strong>Seeds</strong> are a different thing. Seeds are used to plant initial data to a Database. It’s extremely useful when you need to populate your application with data once installed, let’s say an admin user or an example blog post. Seeds are not used in the test suite.</p>

<p><strong>So, what’s the solution?</strong> use factories! Either factory methods or factory classes.</p>

<h2 id="summary">Summary</h2>

<p>In this post, we talked about the location of test files, <strong>in-place</strong> or <strong>out-of-place</strong>. We also talked about using plain English to name the test methods and separating words by underscores. The <code class="language-plaintext highlighter-rouge">Given-When-Then</code> or <code class="language-plaintext highlighter-rouge">Arrange-Act-Assert</code> is a great way to structure test cases. Do you remember what is a fixture? how to use them? and the anti-patterns of the <code class="language-plaintext highlighter-rouge">Given</code> section.</p>

    </div><a class="u-url" href="/blog/testing/how-to-organize-your-unit-tests.html" hidden></a>

    <div class="lg:flex bg-sky-100 border-t-2 border-sky-300 justify-between p-4 text-lg rounded-br-lg rounded-bl-lg">
        <div class="flex flex-col justify-center mb-4 lg:mb-0">
            
           <div class="text-center">
               <p class="uppercase">Previous Post</p>
               <a href="/blog/testing/what-is-a-unit-test.html">&larr;What is a unit test</a>
           </div>
            
        </div>

        <div class="flex flex-col justify-center">
            
        </div>

    </div>
</article>

</main><footer class="bg-white">
    <div class="container mx-auto lg:p-0 p-5">
        <div class="flex flex-col justify-center pt-10 pb-10 text-lg">
            <div class="flex-1 text-center">
                <p>Let's get together</p>
                <ul class="footer-social-links p-0 m-0">
                    
                    <li class="inline"><a href="https://twitter.com/imdhemy">Twitter</a></li>
                    
                    <li class="inline"><a href="https://github.com/imdhemy">Github</a></li>
                    
                    <li class="inline"><a href="https://linkedin.com/in/imdhemy">Linkedin</a></li>
                    
                </ul>
            </div>

            <div class="flex-1 text-center mt-10">
                <p>&copy; 2021 - 2022 imdhemy.com</p>
            </div>
        </div>
    </div>
</footer>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>

<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<script src="https://imdhemy.com/assets/js/script.js?v=2022-11-13-14-54"></script>
</body>

</html>
