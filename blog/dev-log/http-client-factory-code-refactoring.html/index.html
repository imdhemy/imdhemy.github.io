<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HTTP Client Factory Code Refactoring</title>
    <meta name="description"
          content="I‚Äôm working on a Proxy/Adapter project, which we‚Äôll call ‚ÄúBanana.‚Äù Banana is developed in TypeScript and uses Axios for HTTP requests. It‚Äôs designed to commu...">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Display:ital,wght@0,100..900;1,100..900&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Display:ital,wght@0,100..900;1,100..900&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap"
          rel="stylesheet">

    <link rel="canonical" href="https://imdhemy.com/blog/dev-log/http-client-factory-code-refactoring.html/">
    <link rel="stylesheet" href="/assets/css/main.css?v=1.0.0">
    
    <link rel="icon" type="image/png" href="/assets/theme/favicon.png">
    
    

    
    <!-- Facebook Meta Tags -->
<meta property="og:title" content="HTTP Client Factory Code Refactoring">
<meta property="og:type" content="article">
<meta property="og:image" content="https://imdhemy.com">
<meta property="og:url" content="https://imdhemy.com/blog/dev-log/http-client-factory-code-refactoring.html/">
<meta property="og:description"
      content="I‚Äôm working on a Proxy/Adapter project, which we‚Äôll call ‚ÄúBanana.‚Äù Banana is developed in TypeScript and uses Axios for HTTP requests. It‚Äôs designed to commu...">
<meta property="og:site_name" content="Imdhemy">

<!-- Twitter Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="HTTP Client Factory Code Refactoring">
<meta name="twitter:description"
      content="I‚Äôm working on a Proxy/Adapter project, which we‚Äôll call ‚ÄúBanana.‚Äù Banana is developed in TypeScript and uses Axios for HTTP requests. It‚Äôs designed to commu...">
<meta name="twitter:image" content="https://imdhemy.com">


    

</head>
<body class="min-h-screen">
<div class="min-h-screen">
    <header class="relative" id="main-header">
    <div class="container mx-auto">
        <div class="flex py-6 lg:py-14 p-5 lg:px-0">
            <!-- begin logo -->
            <div class="flex-auto">
                <div>
                    <a href="/" class="text-gray-900 text-3xl font-bold">
                        Imdhemy
                    </a>
                </div>
            </div>
            <!-- end logo -->
            <!-- begin right part -->
            <div class="flex-auto">
                <div class="flex justify-end lg:hidden">
                    <button type="button" class="menu-toggle" data-target="#mobile-nav">
                        <ion-icon name="menu-outline"></ion-icon>
                    </button>
                </div>

                <div class="hidden lg:flex justify-end">
                    <ul class="flex items-center">
                        
                        <li class="ml-10">
                            <a href="/"
                               class="text-base font-semibold p-2 text-gray-900 ease-linear hover:text-blue-600 active:text-blue-600">
                                Home
                            </a>
                        </li>
                        
                        <li class="ml-10">
                            <a href="/blog"
                               class="text-base font-semibold p-2 text-gray-900 ease-linear hover:text-blue-600 active:text-blue-600">
                                Blog
                            </a>
                        </li>
                        
                        <li class="ml-10">
                            <a href="/about"
                               class="text-base font-semibold p-2 text-gray-900 ease-linear hover:text-blue-600 active:text-blue-600">
                                About
                            </a>
                        </li>
                        
                    </ul>
                </div>
                <!-- end right part -->
            </div>
            <!-- begin mobile nav -->
            <nav id="mobile-nav"
                 class="menu -z-10 opacity-0 absolute top-32 right-6 block min-w-fit w-40 bg-white p-5 rounded-md shadow-md ease-linear">
                <div class="ml-auto">
                    <ul class="p-0 m-0 flex-column items-center">
                        
                        <li class="block flex-1 w-full m-0">
                            <a href="/"
                               class="block text-right text-base font-semibold p-2 text-gray-900 ease-linear hover:text-blue-600 active:text-blue-600">
                                Home
                            </a>
                        </li>
                        
                        <li class="block flex-1 w-full m-0">
                            <a href="/blog"
                               class="block text-right text-base font-semibold p-2 text-gray-900 ease-linear hover:text-blue-600 active:text-blue-600">
                                Blog
                            </a>
                        </li>
                        
                        <li class="block flex-1 w-full m-0">
                            <a href="/about"
                               class="block text-right text-base font-semibold p-2 text-gray-900 ease-linear hover:text-blue-600 active:text-blue-600">
                                About
                            </a>
                        </li>
                        
                    </ul>
                </div>
            </nav>
            <!-- end mobile nav -->
        </div>
    </div>
</header>

    <main>
        <div class="max-w-screen-md mx-auto bg-white p-5">
    <h1 class="font-black font-sans text-2xl lg:text-4xl post-title">HTTP Client Factory Code Refactoring</h1>
</div>

<div class="max-w-screen-md mx-auto bg-white p-5">
    <div class="flex justify-between flex-wrap my-2">
        <div class="flex items-center mr-8">
            <img src="/theme/images/avatar.jpeg" alt=""
                 class="rounded-full w-10 h-10 mr-3 block"/>
            <div>
                <p class="text-gray-700 text-sm font-bold">Dhemy</p>
                <p class="text-gray-500 text-xs">
                    October 27, 2024 - 2 min read
                </p>
            </div>
        </div>
    </div>

    <div>
        
        <div class="flex mb-5">
    
</div>

    </div>

    
</div>


<div class="m-auto max-w-screen-md bg-white p-5 text-xl content">
    <p>I‚Äôm working on a Proxy/Adapter project, which we‚Äôll call ‚ÄúBanana.‚Äù Banana is developed in TypeScript and uses Axios for
HTTP requests. It‚Äôs designed to communicate with different APIs, each with distinct authentication methods and
configurations.</p>

<p>The system started with a single API, ‚ÄúPeelAPI,‚Äù for which we provided a <code class="language-plaintext highlighter-rouge">createClient</code> function that returned an Axios
instance with the correct configuration. When we added a second API, ‚ÄúBunchAPI,‚Äù we created another <code class="language-plaintext highlighter-rouge">createClient</code>
function for it, but in a different subdomain. The same was done for the third API, ‚ÄúSplitAPI.‚Äù For each Axios instance,
we wrapped errors in a custom error class to identify the source of the error, accomplished by a response interceptor.</p>

<div class="tip">
  <p>One API, one <code class="language-plaintext highlighter-rouge">createClient</code>‚Äîsimple, right? Fast forward to three APIs, and now it‚Äôs like juggling bananas üçåüçåüçå with TypeScript.</p>
</div>

<p>The issue is that we now have a lot of duplicated code, and the <code class="language-plaintext highlighter-rouge">createClient</code> functions break the Single Responsibility
Principle, as they are responsible for both creating the client and handling authentication. I‚Äôm uncertain whether it‚Äôs
best to keep error wrapping within the same function or move it to a separate module after the client is created.</p>

<p>To add complexity, since client tokens are cached in Redis, we need to pass the Cache service to the <code class="language-plaintext highlighter-rouge">createClient</code>
function, although not all clients require token caching. This results in different signatures for each <code class="language-plaintext highlighter-rouge">createClient</code>
function.</p>

<p>I‚Äôm considering using a Factory pattern for client creation. The plan is to unify or standardize the client creation
functions so they have a consistent signature, allowing us to replace them with a single Factory function that creates
clients based on configuration.</p>

<p>I discovered that <code class="language-plaintext highlighter-rouge">baseURL</code> is the only configuration that varies between clients so far. I‚Äôm unsure whether it‚Äôs best
to accept a configuration object or just <code class="language-plaintext highlighter-rouge">baseURL</code> as a parameter. I chose <code class="language-plaintext highlighter-rouge">baseURL</code>, as it‚Äôs easier to handle only when
needed than creating a configuration object with a single property.</p>

<p>Last week, I began refactoring the ‚ÄúPeelAPI‚Äù client and ended up with a <code class="language-plaintext highlighter-rouge">createClient(baseURL: string): AxiosInstance</code>
function, which returns an Axios instance with the correct configuration. I then moved on to ‚ÄúBunchAPI,‚Äù which was less
straightforward because, unlike ‚ÄúPeelAPI,‚Äù ‚ÄúBunchAPI‚Äù requires authentication. I had to extract the authentication logic
into a separate function. I didn‚Äôt change the signature of the <code class="language-plaintext highlighter-rouge">createClient</code> function, planning to address that in the
next merge request.</p>

<div class="tip">
  <p>Once standardized, Factory Pattern will take the wheel. But the question remains: what‚Äôs the cleanest way to handle authentication? ü§î #CodeDesign</p>
</div>

<p>The first merge request is already merged, but I‚Äôm waiting for the second one to be reviewed. Once it‚Äôs merged, I will
standardize the <code class="language-plaintext highlighter-rouge">createClient</code> functions, ensuring that the first two API clients have a consistent signature. Then, the
third API client will be refactored in two steps: first to address authentication, then to standardize the signature.</p>

<p>After all <code class="language-plaintext highlighter-rouge">createClient</code> functions are standardized, I‚Äôll create the Factory function to generate clients based on
configuration. I still need to determine a clean way to handle authentication. Do you have any suggestions?</p>

</div>


    </main>
    <section class="sticky top-[100vh]">
    <div class="p-10">
        <div class="max-w-screen-md mx-auto">
            <p class="text-center">
                <!-- 2001 - jekyll current year -->
                &copy; 2021 - 2024 . imdhemy.com Published by Jekyll, hosted on GitHub Pages.
            </p>
        </div>
    </div>
</section>

</div>


<!-- Ion icons -->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

<!-- Main JS file -->
<script src="/assets/js/dist/main.js?v=1.0.0"></script>
</body>
</html>
